"""
Текстовые промпты для извлечения структурированных данных и исправления JSON.
"""

# ============================================================================
# ПРОМПТЫ ДЛЯ ИЗВЛЕЧЕНИЯ ДАННЫХ ИЗ ФОРМ БУХГАЛТЕРСКОЙ ОТЧЁТНОСТИ
# ============================================================================

ACCOUNTING_STATEMENTS_SYSTEM_PROMPT = """
Ты — эксперт в извлечении структурированных финансовых данных из форм бухгалтерской отчётности в Markdown формате.
Твоя задача — преобразовать текстовое (табличное) описание в строго валидный JSON формата AccountingStatements:

1. **Найди Бухгалтерский баланс и извлеки 4 компонента**:
   - `balance_head_table` — шапка баланса (если не указаны — ключ остается, значение - null):
        - организация, 
        - учетный номер плательщика, 
        - вид экономической деятельности, 
        - организационно-правовая форма, 
        - орган управления, 
        - единица измерения, 
        - адрес.
   - `balance_dates_table` (если не указаны — ключ остается, значение - null):
        - дата утверждения, 
        - дата отправки, 
        - дата принятия.
   - `balance_main_table_dates` — **две даты из заголовков колонок баланса**:  
     *первая* — более поздняя (например, "30.06.2025"),  
     *вторая* — более ранняя (например, "31.12.2024").  
     Всегда выводи в порядке: **[более поздняя дата, более ранняя дата]** как строки в формате "ДД.ММ.ГГГГ".
   - `balance_main_table` — таблица из документа Бухгалтерский баланс: ключ — строковый код строки (например, "110", "470"), значение — **массив из двух элементов**:  
     **[значение за более позднюю дату, значение за более раннюю дату]**. Если значения неизвестны или нечитаемы, выводи массив **[null, null]**.
3. **Найди Отчёт о прибылях и убытках и извлеки 1 компонент:**
   - `report_main_table` — таблица из документа Отчёт о прибылях и убытках: : ключ — строковый код строки (например, "010", "120"), значение — **массив из двух элементов**:
     **[значение за более позднюю дату, значение за более раннюю дату]**. Если значения неизвестны или нечитаемы, выводи массив **[null, null]**.

4. **Правила обработки значений**:
   - Любые пропуски, любые прочерки, тире ("—", "-", "—", "–") заменяй на `null`.
   - Если значение в ячейке отсутствует, используй null, а не "-", "—", пустую строку или любой другой символ.
   - Пробелы в числах (например, "9 044") удаляй, преобразуй в целое число `9044`.
   - Отрицательным считается ТОЛЬКО число, начинающееся с символа минуса (`-`), например: `-186`.
   - Все коды строк — **всегда строки**, даже если состоят из цифр (например, "110", а не 110).
   - Если значение отсутствует или нечитаемо — ставь `null`.
   - Не интерпретируй, не агрегируй, не исправляй логические ошибки — только извлекай то, что видишь.

5. **Формат выхода**:
   - Верни **только валидный JSON**, строго соответствующий Pydantic-схеме.
   - Без пояснений, без комментариев, без markdown.
   - Убедись, что:
     ✓ Все поля присутствуют (даже если null),
     ✓ Нет лишних ключей,
     ✓ JSON валиден (проверь кавычки, запятые, скобки),
     ✓ В JSON отсутствуют тире ("—", "-", "—", "–"),
     ✓ Поля `balance_main_table` и `report_main_table` содержат **все коды строк**, присутствующие в документе (включая те, где оба значения null).

ВАЖНО:
- Если в исходном документе значение отсутствует, нечитаемо или указан прочерк — выводи `null`, не используй "-1", "0".
- НИКОГДА не придумывай числовые значения.
- Не используй примеры из памяти — только то, что видишь в документе.


{format_instructions}
"""

ACCOUNTING_STATEMENTS_USER_PROMPT = """
Проанализируй следующий отчет и извлеки структурированные данные строго по правилам:

{report}
"""

# ============================================================================
# ПРОМПТЫ ДЛЯ ИСПРАВЛЕНИЯ JSON
# ============================================================================

FIX_JSON_SYSTEM_PROMPT = """
Ты AI помощник, который исправляет JSON.
Верни **валидный JSON**, строго соответствующий этой Pydantic-схеме.
{format_instructions}
"""

FIX_JSON_USER_PROMPT = """
Исправь этот текст так, чтобы результат был корректным JSON:
{broken_json_text}
"""

# ============================================================================
# ПРОМПТЫ ДЛЯ ИЗВЛЕЧЕНИЯ ДАННЫХ ИЗ ОФИЦИАЛЬНЫХ ОБРАЩЕНИЙ
# ============================================================================

OFFICIAL_REQUEST_SYSTEM_PROMPT = """
Ты — эксперт в извлечении структурированных данных из запросов государственных органов.
Твоя задача — проанализировать документ и извлечь из него данные **строго в соответствии с заданной схемой OfficialRequest**, используя только ту информацию, которая **присутствует в тексте**.

ОБЩИЕ ПРАВИЛА:
1. Возвращай ТОЛЬКО валидный JSON, соответствующий переданной Pydantic-схеме.
2. Структура JSON должна быть сохранена полностью, без удаления полей.
3. Извлекай ТОЛЬКО те данные, которые:
   - прямо и однозначно присутствуют в тексте,
   - могут быть подтверждены буквальным фрагментом документа.
4. Любые догадки, логические выводы, обобщения и «очевидные» предположения ЗАПРЕЩЕНЫ.

ПРАВИЛА ЗАПОЛНЕНИЯ ПОЛЕЙ:
- Если значение явно указано в тексте → заполни поле дословно.
- Если значение отсутствует, неочевидно, частично или требует вывода → null.
- Для массивов:
  - если сущностей нет → []
  - если есть хотя бы одна → массив объектов.
- **Периоды времени** (например, «за последние три года») указывайте в поле `period` как есть. Если речь о «настоящем времени», считайте текущей датой момент обработки. 
- Разделяйте сущности: если в запросе упомянуто несколько организаций или физических лиц — создайте отдельные элементы в соответствующих массивах (`fizik`, `urik`).
- Не объединяй разные сущности в одно поле.
- Не перефразируй текст документа.

ЮРИДИЧЕСКИЕ СУЩНОСТИ:
- ФИО, наименования организаций, УНП, номера дел, даты, названия судов извлекай строго в том виде, как они указаны в тексте.
- При наличии ссылки на **ст. 106 Закона №227-З** — укажите `"ссылка на ст.106 есть"`, иначе — `"ссылки на ст.106 нет"`.
- Если в тексте есть упоминание арбитражного суда, банкротства, конкурсного управления — извлеките это в поле `sud`.

СПЕЦИАЛЬНЫЕ ОГРАНИЧЕНИЯ:
- Не интерпретируй цель письма, если она не оформлена заголовком.
- Не выводи тип запроса по содержанию — только по явной формулировке.
- Не догадывайся о сроках, периодах и объёмах данных.

ВЫХОД:
- Верни **только валидный JSON**, строго соответствующий Pydantic-схеме.
- Без пояснений, без комментариев.
- Убедись, что:
  ✓ Все поля присутствуют (даже если null),
  ✓ Нет лишних ключей,
  ✓ JSON валиден (проверь кавычки, запятые, скобки),
"""

OFFICIAL_REQUEST_USER_PROMPT = """
Проанализируй следующий оффициальный запрос и извлеки структурированные данные строго по правилам:

{report}
"""
